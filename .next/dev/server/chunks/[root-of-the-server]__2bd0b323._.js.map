{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/poeunj/Documents/GitHub/mountain_madness_project/app/api/generate-article/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\"\n\nconst GEMINI_URL =\n  \"https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent\"\n\nconst PROMPT = `You are a writer. Generate ONE brand-new short piece for a web page. Do NOT copy or imitate any existing book (e.g. not L'Ã‰tranger, not The Stranger, not Camus). Invent something original every time.\n\nGENRE: Pick at random either HORROR or HUMOUR. Write only in that genre.\n\nOUTPUT: Valid JSON only. No markdown, no code fences. Exactly this structure:\n{\"title\":\"Story title\",\"author\":\"By Author Name\",\"paragraphs\":[\"First paragraph.\",\"Second paragraph.\",\"Third paragraph.\"]}\n\nRULES:\n- title: One line, creative, random. Different every time.\n- author: \"By \" plus a made-up author name. Random every time.\n- paragraphs: Exactly 3 strings. Each paragraph is SHORT: 2 to 4 sentences only. First paragraph sets the scene, second develops, third ends or leaves a hook. Do not write long paragraphs.\n- Language: English (or one other language if it fits).\n- HORROR: tension, atmosphere, unease. No excessive gore.\n- HUMOUR: wit, absurdity, or dry comedy.\n- Output ONLY the JSON object. Nothing else.`\n\nexport async function GET() {\n  const apiKey =\n    process.env.GEMINI_API_KEY ??\n    process.env.NEXT_PUBLIC_GEMINI_API_KEY ??\n    process.env.GOOGLE_API_KEY ??\n    \"\"\n  if (!apiKey.trim()) {\n    return NextResponse.json(\n      {\n        error:\n          \"GEMINI_API_KEY not set. Add GEMINI_API_KEY=your_key or NEXT_PUBLIC_GEMINI_API_KEY=your_key to .env.local and restart the dev server.\",\n      },\n      { status: 500 }\n    )\n  }\n\n  try {\n    const url = `${GEMINI_URL}?key=${encodeURIComponent(apiKey)}`\n    const res = await fetch(url, {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          \"x-goog-api-key\": apiKey,\n        },\n        body: JSON.stringify({\n          contents: [{ role: \"user\", parts: [{ text: PROMPT }] }],\n          generationConfig: {\n            temperature: 0.95,\n            maxOutputTokens: 2048,\n            responseMimeType: \"application/json\",\n          },\n        }),\n      }\n    )\n\n    if (!res.ok) {\n      const err = await res.text()\n      console.error(\"Gemini API error:\", res.status, err)\n      return NextResponse.json(\n        { error: \"Gemini API request failed\", details: err },\n        { status: 502 }\n      )\n    }\n\n    const data = await res.json()\n    let text =\n      data?.candidates?.[0]?.content?.parts?.[0]?.text?.trim() ?? \"\"\n    if (!text) {\n      return NextResponse.json(\n        { error: \"No text in Gemini response\" },\n        { status: 502 }\n      )\n    }\n    // Gemini may wrap JSON in ```json ... ```\n    if (text.startsWith(\"```\")) {\n      text = text.replace(/^```(?:json)?\\s*\\n?/, \"\").replace(/\\n?```\\s*$/, \"\")\n    }\n\n    const parsed = JSON.parse(text) as {\n      title?: string\n      author?: string\n      paragraphs?: string[]\n    }\n    const title =\n      typeof parsed.title === \"string\" ? parsed.title : \"Untitled\"\n    const author =\n      typeof parsed.author === \"string\" ? parsed.author : \"By Unknown\"\n    const rawParagraphs = Array.isArray(parsed.paragraphs)\n      ? parsed.paragraphs.filter((p): p is string => typeof p === \"string\")\n      : []\n\n    const paragraphs: [string, string, string] = [\n      rawParagraphs[0] ?? \"\",\n      rawParagraphs[1] ?? \"\",\n      rawParagraphs[2] ?? \"\",\n    ]\n\n    return NextResponse.json({ title, author, paragraphs })\n  } catch (e) {\n    console.error(\"generate-article error:\", e)\n    return NextResponse.json(\n      { error: e instanceof Error ? e.message : \"Unknown error\" },\n      { status: 500 }\n    )\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,aACJ;AAEF,MAAM,SAAS,CAAC;;;;;;;;;;;;;;4CAc4B,CAAC;AAEtC,eAAe;IACpB,MAAM,SACJ,QAAQ,GAAG,CAAC,cAAc,oFAE1B,QAAQ,GAAG,CAAC,cAAc,IAC1B;IACF,IAAI,CAAC,OAAO,IAAI,IAAI;QAClB,OAAO,+QAAY,CAAC,IAAI,CACtB;YACE,OACE;QACJ,GACA;YAAE,QAAQ;QAAI;IAElB;IAEA,IAAI;QACF,MAAM,MAAM,GAAG,WAAW,KAAK,EAAE,mBAAmB,SAAS;QAC7D,MAAM,MAAM,MAAM,MAAM,KAAK;YACzB,QAAQ;YACR,SAAS;gBACP,gBAAgB;gBAChB,kBAAkB;YACpB;YACA,MAAM,KAAK,SAAS,CAAC;gBACnB,UAAU;oBAAC;wBAAE,MAAM;wBAAQ,OAAO;4BAAC;gCAAE,MAAM;4BAAO;yBAAE;oBAAC;iBAAE;gBACvD,kBAAkB;oBAChB,aAAa;oBACb,iBAAiB;oBACjB,kBAAkB;gBACpB;YACF;QACF;QAGF,IAAI,CAAC,IAAI,EAAE,EAAE;YACX,MAAM,MAAM,MAAM,IAAI,IAAI;YAC1B,QAAQ,KAAK,CAAC,qBAAqB,IAAI,MAAM,EAAE;YAC/C,OAAO,+QAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;gBAA6B,SAAS;YAAI,GACnD;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,IAAI,OACF,MAAM,YAAY,CAAC,EAAE,EAAE,SAAS,OAAO,CAAC,EAAE,EAAE,MAAM,UAAU;QAC9D,IAAI,CAAC,MAAM;YACT,OAAO,+QAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAA6B,GACtC;gBAAE,QAAQ;YAAI;QAElB;QACA,0CAA0C;QAC1C,IAAI,KAAK,UAAU,CAAC,QAAQ;YAC1B,OAAO,KAAK,OAAO,CAAC,uBAAuB,IAAI,OAAO,CAAC,cAAc;QACvE;QAEA,MAAM,SAAS,KAAK,KAAK,CAAC;QAK1B,MAAM,QACJ,OAAO,OAAO,KAAK,KAAK,WAAW,OAAO,KAAK,GAAG;QACpD,MAAM,SACJ,OAAO,OAAO,MAAM,KAAK,WAAW,OAAO,MAAM,GAAG;QACtD,MAAM,gBAAgB,MAAM,OAAO,CAAC,OAAO,UAAU,IACjD,OAAO,UAAU,CAAC,MAAM,CAAC,CAAC,IAAmB,OAAO,MAAM,YAC1D,EAAE;QAEN,MAAM,aAAuC;YAC3C,aAAa,CAAC,EAAE,IAAI;YACpB,aAAa,CAAC,EAAE,IAAI;YACpB,aAAa,CAAC,EAAE,IAAI;SACrB;QAED,OAAO,+QAAY,CAAC,IAAI,CAAC;YAAE;YAAO;YAAQ;QAAW;IACvD,EAAE,OAAO,GAAG;QACV,QAAQ,KAAK,CAAC,2BAA2B;QACzC,OAAO,+QAAY,CAAC,IAAI,CACtB;YAAE,OAAO,aAAa,QAAQ,EAAE,OAAO,GAAG;QAAgB,GAC1D;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}